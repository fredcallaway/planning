// Generated by CoffeeScript 1.12.3

/* jspsych-webppl.js
 * Fred Callaway
 */
jsPsych.plugins.webppl = (function() {
  var plugin;
  plugin = {};
  console.log('LOAD WEBPPL');
  plugin.trial = function(display_element, trial) {
    trial = jsPsych.pluginAPI.evaluateFunctionParameters(trial);
    display_element.html('');
    if (trial.file != null) {
      $.ajax({
        url: trial.file,
        async: false,
        dataType: 'text',
        success: function(code) {
          return trial.code = code;
        }
      });
    }
    if (trial.code == null) {
      throw new Error('jspsych-webppl: No code or file provided!');
    }
    if (trial.globalStore == null) {
      trial.globalStore = {};
    }
    trial.globalStore.display_element = display_element;
    trial.globalStore.getKeyboardResponse = function(params, callback) {
      var default_params;
      default_params = {
        callback_function: callback,
        valid_responses: [],
        persist: false
      };
      params = _.extend(default_params, params);
      console.log('params', params);
      return jsPsych.pluginAPI.getKeyboardResponse(params);
    };
    if (trial.onFinish == null) {
      trial.onFinish = function(s, val) {
        return console.log("webppl returned " + val);
      };
    }
    return webppl.run(trial.code, trial.onFinish, {
      initialStore: trial.globalStore
    });
  };
  return plugin;
})();
